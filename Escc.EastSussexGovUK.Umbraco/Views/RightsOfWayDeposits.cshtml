@using ClientDependency.Core.Mvc
@using Escc.ClientDependencyFramework
@using Escc.EastSussexGovUK
@using Escc.EastSussexGovUK.Features
@using Escc.EastSussexGovUK.Skins
@using Escc.EastSussexGovUK.Views
@using Escc.Dates
@using Escc.EastSussexGovUK.Umbraco.RightsOfWayDeposits
@inherits Umbraco.Web.Mvc.UmbracoViewPage<Escc.EastSussexGovUK.Umbraco.RightsOfWayDeposits.RightsOfWayDepositsViewModel>
@{
    Model.EsccWebsiteView = ViewSelector.CurrentViewIs(Layout, ViewEngine.Mvc);
    Model.EsccWebsiteSkin = new CustomerFocusSkin(Model.EsccWebsiteView);

    Html.Partial("~/Views/EastSussexGovUK/_FeatureDependencies.cshtml", new List<IClientDependencySet>()
    {
        new WebChat() { WebChatSettings = Model.WebChat }
    });

    var queryWithoutSort = HttpUtility.ParseQueryString(Request.Url.Query);
    queryWithoutSort.Remove("sort");
    var urlWithoutSort = Request.Url.AbsolutePath + "?" + queryWithoutSort;
    if (queryWithoutSort.Count > 0) { urlWithoutSort += "&"; }
    urlWithoutSort += "sort=";
}

<div class="full-page">
    <article>
        <div class="content text-content">

            <h1>@Model.Metadata.Title</h1>

            @Html.Partial("~/Views/EastSussexGovUK/Features/_Latest.cshtml")

            @{ Html.RenderPartial("~/Views/_PagingBarControl.ascx", Model.Paging); }

            <table>
                <thead><tr>
                    <th scope="col"><a href="@urlWithoutSort@(Model.SortOrder == RightsOfWayDepositsSortOrder.ReferenceAscending ? "referencedescending" : "referenceascending")">Reference</a></th>
                    <th scope="col"><a href="@urlWithoutSort@(Model.SortOrder == RightsOfWayDepositsSortOrder.OwnerAscending ? "ownerdescending" : "ownerascending")">Owner</a></th>
                    <th scope="col"><a href="@urlWithoutSort@(Model.SortOrder == RightsOfWayDepositsSortOrder.ParishAscending ? "parishdescending" : "parishascending")">Parish</a></th>
                    <th scope="col"><a href="@urlWithoutSort@(Model.SortOrder == RightsOfWayDepositsSortOrder.DateDepositedAscending ? "datedepositeddescending" : "datedepositedascending")">Date deposited</a></th>
                    <th scope="col"><a href="@urlWithoutSort@(Model.SortOrder == RightsOfWayDepositsSortOrder.DateExpiresAscending ? "dateexpiresdescending" : "dateexpiresascending")">Expires</a></th>
                </tr></thead>
                @foreach (var deposit in Model.Deposits)
                {
                    <tr><td><a href="@deposit.DepositUrl">@deposit.Reference</a></td><td>@deposit.Owner</td><td>@deposit.Parish</td><td>@deposit.DateDeposited.ToShortBritishDate()</td><td>@deposit.DateExpires.ToShortBritishDate()</td></tr>
                }
            </table>
            
            @{ Html.RenderPartial("~/Views/_PagingBarControl.ascx", Model.Paging); }
        </div>
    </article>
</div>

@Html.Partial("~/Views/Layouts/_SocialMedia.cshtml")
@Html.Partial("~/Views/EastSussexGovUK/Features/_SupportingContentDesktop.cshtml")
<div class="text-content content">
    @Html.Partial("~/Views/EastSussexGovUK/Features/_Share.cshtml")
</div>
@using System.Globalization
@using Escc.Dates
@inherits Umbraco.Web.Mvc.UmbracoViewPage<Escc.EastSussexGovUK.Umbraco.RightsOfWayDeposits.RightsOfWayDepositsViewModel>
@{
    Layout = null;
    Response.ContentType = "text/csv";
    Response.Headers.Remove("Content-Security-Policy");
    Response.AddHeader("Content-disposition", "attachment;filename=east-sussex-rights-of-way-deposits-" + DateTime.Now.ToUkDateTime().ToIso8601Date() + ".csv");
}"Reference","Individual Owner 1 Title","Individual Owner 1 Given Name","Individual Owner 1 Family Name","Individual Owner 1 Suffix","Individual Owner 2 Title","Individual Owner 2 Given Name","Individual Owner 2 Family Name","Individual Owner 2 Suffix","Individual Owner 3 Title","Individual Owner 3 Given Name","Individual Owner 3 Family Name","Individual Owner 3 Suffix","Individual Owner 4 Title","Individual Owner 4 Given Name","Individual Owner 4 Family Name","Individual Owner 4 Suffix","Individual Owner 5 Title","Individual Owner 5 Given Name","Individual Owner 5 Family Name","Individual Owner 5 Suffix","Organisational Owner 1","Organisational Owner 2","Organisational Owner 3","Organisational Owner 4","Organisational Owner 5","Address 1 line 1 (SAON)","Address 1 line 2 (PAON)","Street name 1","Locality 1","Town 1","Administrative Area 1","Postcode 1","Latitude 1","Longitude 1","Address 2 line 1 (SAON)","Address 2 line 2 (PAON)","Street name 2","Locality 2","Town 2","Administrative Area 2","Postcode 2","Latitude 2","Longitude 2","Address 3 line 1 (SAON)","Address 3 line 2 (PAON)","Street name 3","Locality 3","Town 3","Administrative Area 3","Postcode 3","Latitude 3","Longitude 3","Address 4 line 1 (SAON)","Address 4 line 2 (PAON)","Street name 4","Locality 4","Town 4","Administrative Area 4","Postcode 4","Latitude 4","Longitude 4","Address 5 line 1 (SAON)","Address 5 line 2 (PAON)","Street name 5","Locality 5","Town 5","Administrative Area 5","Postcode 5","Latitude 5","Longitude 5","Parishes","Description","Ordnance Survey grid reference","Date deposited","Expires","Deposit URL","Web page URL"
@{
    foreach (var deposit in Model.Deposits)
    {
        var data = new System.Text.StringBuilder();
        data.Append("\"").Append(deposit.Reference).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 0 ? deposit.IndividualOwners[0].Titles.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 0 ? deposit.IndividualOwners[0].GivenNames.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 0 ? deposit.IndividualOwners[0].FamilyName.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 0 ? deposit.IndividualOwners[0].Suffixes.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 1 ? deposit.IndividualOwners[1].Titles.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 1 ? deposit.IndividualOwners[1].GivenNames.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 1 ? deposit.IndividualOwners[1].FamilyName.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 1 ? deposit.IndividualOwners[1].Suffixes.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 2 ? deposit.IndividualOwners[2].Titles.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 2 ? deposit.IndividualOwners[2].GivenNames.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 2 ? deposit.IndividualOwners[2].FamilyName.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 2 ? deposit.IndividualOwners[2].Suffixes.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 3 ? deposit.IndividualOwners[3].Titles.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 3 ? deposit.IndividualOwners[3].GivenNames.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 3 ? deposit.IndividualOwners[3].FamilyName.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 3 ? deposit.IndividualOwners[3].Suffixes.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 4 ? deposit.IndividualOwners[4].Titles.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 4 ? deposit.IndividualOwners[4].GivenNames.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 4 ? deposit.IndividualOwners[4].FamilyName.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.IndividualOwners.Count > 4 ? deposit.IndividualOwners[4].Suffixes.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.OrganisationalOwners.Count > 0 ? deposit.OrganisationalOwners[0] : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.OrganisationalOwners.Count > 1 ? deposit.OrganisationalOwners[1] : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.OrganisationalOwners.Count > 2 ? deposit.OrganisationalOwners[2] : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.OrganisationalOwners.Count > 3 ? deposit.OrganisationalOwners[3] : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.OrganisationalOwners.Count > 4 ? deposit.OrganisationalOwners[4] : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 0 ? deposit.Addresses[0].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 1 ? deposit.Addresses[1].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 2 ? deposit.Addresses[2].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 3 ? deposit.Addresses[3].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(deposit.Addresses.Count > 4 ? deposit.Addresses[4].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(String.Join(", ", deposit.Parishes)).Append("\",");
        data.Append("\"").Append(String.Join(", ", deposit.Description.Replace("\"", String.Empty))).Append("\",");
        data.Append("\"").Append(deposit.OrdnanceSurveyGridReference).Append("\",");
        data.Append("\"").Append(deposit.DateDeposited.ToIso8601Date()).Append("\",");
        data.Append("\"").Append(deposit.DateExpires.ToIso8601Date()).Append("\",");
        var depositDocuments = new List<string>();
        foreach (var doc in deposit.DepositDocuments) { depositDocuments.Add(doc.Url.ToString()); }
        data.Append("\"").Append(String.Join(", ", depositDocuments)).Append("\",");
        data.Append("\"").Append(deposit.PageUrl).Append("\"");
@Html.Raw(data)
}
}
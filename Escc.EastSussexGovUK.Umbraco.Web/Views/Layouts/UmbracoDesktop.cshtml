@using ClientDependency.Core.Mvc
@using Escc.ClientDependencyFramework
@using Escc.EastSussexGovUK
@using Escc.EastSussexGovUK.Features
@using Escc.EastSussexGovUK.Views
@using Escc.EastSussexGovUK.Mvc
@using Escc.EastSussexGovUK.Mvc.Views.EastSussexGovUK
@using Escc.Net.Configuration
@inherits Umbraco.Web.Mvc.UmbracoViewPage<Escc.EastSussexGovUK.Mvc.BaseViewModel>
@{
    Layout = "~/Views/EastSussexGovUK/desktop.cshtml";
    Html.RequiresJs(JsFileAlias.Resolve("DocumentMetadata"));
    Html.RequiresJs("~/js/embed-jobs-rss.js");

    // Configure the client that loads elements of the remote master page
    var textSize = new TextSize(Request.Cookies?["textsize"]?.Value, Request.QueryString).CurrentTextSize();
    var isLibraryCatalogueRequest = new LibraryCatalogueContext(Request.UserAgent).RequestIsFromLibraryCatalogueMachine();
    var proxyProvider = new ConfigurationProxyProvider();
    var masterPageSettings = new RemoteMasterPageSettingsFromConfig();
    var forceCacheRefresh = (Request.QueryString["ForceCacheRefresh"] == "1"); // Provide a way to force an immediate update of the cache
    var masterPageControlProvider = new RemoteMasterPageHtmlProvider(masterPageSettings.MasterPageControlUrl(), proxyProvider, Request.UserAgent, masterPageSettings.RequestTimeout(), new RemoteMasterPageMemoryCacheProvider(masterPageSettings.CacheTimeout()), forceCacheRefresh);
}
@section ContentExperiment {
    @{ Html.RenderPartial("~/Views/Layouts/_ContentExperiment.cshtml", Model); }
}
@section WebChat {}
@section Metadata
{
    @{ Html.RenderPartial("~/Views/Layouts/_CmsPreview.cshtml", Model); }
    @RenderSection("Metadata", required: false)
}
@section BodyClass{@RenderSection("BodyClass", required: false)}
@section Header {
    @if (IsSectionDefined("Header"))
    {
        @RenderSection("Header")
    }
    else
    {
        Html.RenderPartial("~/Views/EastSussexGovUK/_MasterPageControl.cshtml", new MasterPageControlData { Control = "HeaderDesktop", BreadcrumbProvider = Model.BreadcrumbProvider, HtmlControlProvider = masterPageControlProvider, TextSize = textSize, IsLibraryCatalogueRequest = isLibraryCatalogueRequest });
    }
}
@section Breadcrumb {
    @if (IsSectionDefined("Breadcrumb"))
    {
        @RenderSection("Breadcrumb")
    }
    else
    {
        Html.RenderPartial("~/Views/EastSussexGovUK/_BreadcrumbTrail.cshtml", Model.BreadcrumbProvider);
        Html.RenderPartial("~/Views/EastSussexGovUK/_BreadcrumbTrailMobile.cshtml", Model.BreadcrumbProvider);
    }
}
@RenderBody()
@section Footer {
    @if (IsSectionDefined("Footer"))
    {
        @RenderSection("Footer")
    }
    else
    {
        Html.RenderPartial("~/Views/EastSussexGovUK/_MasterPageControl.cshtml", new MasterPageControlData { Control = "FooterDesktop", BreadcrumbProvider = Model.BreadcrumbProvider, HtmlControlProvider = masterPageControlProvider, TextSize = textSize, IsLibraryCatalogueRequest = isLibraryCatalogueRequest });
    }
}
@section JavaScript
{
    @RenderSection("JavaScript", required: false)
}
@using System.Globalization
@using Escc.Dates
@inherits Umbraco.Web.Mvc.UmbracoViewPage<Escc.EastSussexGovUK.Umbraco.Web.RightsOfWayModifications.RightsOfWayModificationsViewModel>
@{
    Layout = null;
    Response.ContentType = "text/csv";
    Response.Headers.Remove("Content-Security-Policy");
    Response.AddHeader("Content-disposition", "attachment;filename=east-sussex-rights-of-way-modification-orders-" + DateTime.Now.ToUkDateTime().ToIso8601Date() + ".csv");
}"Reference","Organisational Owner 1","Organisational Owner 2","Organisational Owner 3","Organisational Owner 4","Organisational Owner 5","Address 1 line 1 (SAON)","Address 1 line 2 (PAON)","Street name 1","Locality 1","Town 1","Administrative Area 1","Postcode 1","Latitude 1","Longitude 1","Address 2 line 1 (SAON)","Address 2 line 2 (PAON)","Street name 2","Locality 2","Town 2","Administrative Area 2","Postcode 2","Latitude 2","Longitude 2","Address 3 line 1 (SAON)","Address 3 line 2 (PAON)","Street name 3","Locality 3","Town 3","Administrative Area 3","Postcode 3","Latitude 3","Longitude 3","Address 4 line 1 (SAON)","Address 4 line 2 (PAON)","Street name 4","Locality 4","Town 4","Administrative Area 4","Postcode 4","Latitude 4","Longitude 4","Address 5 line 1 (SAON)","Address 5 line 2 (PAON)","Street name 5","Locality 5","Town 5","Administrative Area 5","Postcode 5","Latitude 5","Longitude 5","Nearest town or village","Parishes","Description of route","Status claimed","Ordnance Survey grid reference","Date received","Individual Applicant Title","Individual Applicant Given Name","Individual Applicant Family Name","Individual Applicant Suffix","Applicant Organisation","Council Officer Assigned Title","Council Officer Assigned Given Name","Council Officer Assigned Family Name","Council Officer Assigned Suffix","Application Status","Decision","Date determined","Date modification order confirmed","Document URLs","Web page URL"
@{
    foreach (var application in Model.ModificationOrderApplications)
    {
        var data = new System.Text.StringBuilder();
        data.Append("\"").Append(application.Reference).Append("\",");
        data.Append("\"").Append(application.OrganisationalOwners.Count > 0 ? application.OrganisationalOwners[0] : string.Empty).Append("\",");
        data.Append("\"").Append(application.OrganisationalOwners.Count > 1 ? application.OrganisationalOwners[1] : string.Empty).Append("\",");
        data.Append("\"").Append(application.OrganisationalOwners.Count > 2 ? application.OrganisationalOwners[2] : string.Empty).Append("\",");
        data.Append("\"").Append(application.OrganisationalOwners.Count > 3 ? application.OrganisationalOwners[3] : string.Empty).Append("\",");
        data.Append("\"").Append(application.OrganisationalOwners.Count > 4 ? application.OrganisationalOwners[4] : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 0 ? application.Addresses[0].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 1 ? application.Addresses[1].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 2 ? application.Addresses[2].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 3 ? application.Addresses[3].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].BS7666Address.Saon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].BS7666Address.Paon : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].BS7666Address.StreetName : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].BS7666Address.Locality : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].BS7666Address.Town : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].BS7666Address.AdministrativeArea : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].BS7666Address.Postcode : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].GeoCoordinate?.Latitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.Addresses.Count > 4 ? application.Addresses[4].GeoCoordinate?.Longitude.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(String.Join(", ", application.NearestTownOrVillage?.Replace("\"", String.Empty))).Append("\",");
        data.Append("\"").Append(String.Join(", ", application.Parishes)).Append("\",");
        data.Append("\"").Append(String.Join(", ", application.DescriptionOfRoute?.Replace("\"", String.Empty))).Append("\",");
        data.Append("\"").Append(String.Join(", ", application.StatusClaimed?.Replace("\"", String.Empty))).Append("\",");
        data.Append("\"").Append(application.OrdnanceSurveyGridReference).Append("\",");
        data.Append("\"").Append(application.DateReceived.ToIso8601Date()).Append("\",");
        data.Append("\"").Append(application.IndividualApplicant != null ? application.IndividualApplicant.Titles.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.IndividualApplicant != null ? application.IndividualApplicant.GivenNames.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.IndividualApplicant != null ? application.IndividualApplicant.FamilyName.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.IndividualApplicant != null ? application.IndividualApplicant.Suffixes.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(String.Join(", ", application.OrganisationalApplicant?.Replace("\"", String.Empty))).Append("\",");
        data.Append("\"").Append(application.CouncilOfficerAssigned != null ? application.CouncilOfficerAssigned.Titles.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.CouncilOfficerAssigned != null ? application.CouncilOfficerAssigned.GivenNames.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.CouncilOfficerAssigned != null ? application.CouncilOfficerAssigned.FamilyName.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(application.CouncilOfficerAssigned != null ? application.CouncilOfficerAssigned.Suffixes.ToString() : string.Empty).Append("\",");
        data.Append("\"").Append(String.Join(", ", application.ApplicationStatus?.Replace("\"", String.Empty))).Append("\",");
        data.Append("\"").Append(String.Join(", ", application.Decision?.Replace("\"", String.Empty))).Append("\",");
        data.Append("\"").Append(application.DateDetermined.ToIso8601Date()).Append("\",");
        data.Append("\"").Append(application.DateModificationOrderConfirmed.ToIso8601Date()).Append("\",");
        var documents = new List<string>();
        foreach (var doc in application.ApplicationDocuments) { documents.Add(doc.Url.ToString()); }
        data.Append("\"").Append(String.Join(", ", documents)).Append("\",");
        data.Append("\"").Append(application.PageUrl).Append("\"");
        data.Append(Environment.NewLine);
        @Html.Raw(data)
    }
}